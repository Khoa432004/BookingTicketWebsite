(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{1734:(e,t,n)=>{"use strict";n.r(t),n.d(t,{NotificationPanel:()=>g});var l=n(5155),s=n(2115),a=n(4416),i=n(7168),r=n(5139),c=n(2714),d=n(5784),o=n(3999),h=n(9840),m=n(3376),u=n(7257);let x=(e,t)=>e.length<=t?e:e.substring(0,t)+"...";function g(e){let{onClose:t}=e,[n,g]=(0,s.useState)(!1),[f,j]=(0,s.useState)("all"),[p,v]=(0,s.useState)(null),[y,b]=(0,s.useState)([]),[w,N]=(0,s.useState)(!0),[k,C]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{N(!0);let e=await m.A.get("".concat((0,u.$_)(),"/notifications"),{withCredentials:!0});if(!Array.isArray(e.data))throw Error("Dữ liệu trả về từ API kh\xf4ng phải l\xe0 mảng");let t=e.data.map(e=>{let t=new Date(e.createdAt);return{id:e.id,title:e.title,content:e.content,time:t.toLocaleString("vi-VN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"}),read:e.read||!1,fullContent:e.content,target:e.target.toLowerCase(),createdAt:t}});b(t)}catch(t){var e;"ERR_NETWORK"===t.code?C("Kh\xf4ng thể kết nối đến m\xe1y chủ. Vui l\xf2ng kiểm tra xem backend c\xf3 đang chạy kh\xf4ng."):(null===(e=t.response)||void 0===e?void 0:e.status)===401?C("Phi\xean đăng nhập đ\xe3 hết hạn. Vui l\xf2ng đăng nhập lại."):C("Kh\xf4ng thể tải th\xf4ng b\xe1o. Vui l\xf2ng thử lại sau."),console.error("Error fetching notifications:",t)}finally{N(!1)}})()},[]);let A=y.filter(e=>{let t="staff"===e.target||"all"===e.target,l=!n||!e.read,s=new Date,a=!0;if("all"!==f){let t=e.createdAt;if("today"===f)a=t>=new Date(s.getFullYear(),s.getMonth(),s.getDate());else if("week"===f){let e=new Date(s);e.setDate(s.getDate()-7),a=t>=e}else"month"===f&&(a=t>=new Date(s.getFullYear(),s.getMonth(),1))}return t&&l&&a}),D=async e=>{v(e);try{await m.A.put("".concat((0,u.$_)(),"/notifications/").concat(e.id,"/read"),{},{withCredentials:!0}),b(t=>t.map(t=>t.id===e.id?{...t,read:!0}:t))}catch(e){console.error("Error marking notification as read:",e)}};return(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-end bg-black/50 md:items-center md:justify-center",onClick:t,children:(0,l.jsxs)("div",{className:"h-full w-full max-w-md overflow-auto bg-background p-4 shadow-lg md:h-auto md:max-h-[80vh] md:rounded-lg",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between border-b pb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:"Th\xf4ng b\xe1o"}),(0,l.jsxs)(i.$,{variant:"ghost",size:"icon",onClick:t,children:[(0,l.jsx)(a.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Đ\xf3ng"})]})]}),(0,l.jsxs)("div",{className:"my-4 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(r.S,{id:"unread-only",checked:n,onCheckedChange:e=>g(!!e)}),(0,l.jsx)(c.J,{htmlFor:"unread-only",children:"Chỉ hiển thị chưa đọc"})]}),(0,l.jsxs)(d.l6,{value:f,onValueChange:j,children:[(0,l.jsx)(d.bq,{className:"w-full md:w-[180px]",children:(0,l.jsx)(d.yv,{placeholder:"Lọc theo thời gian"})}),(0,l.jsxs)(d.gC,{children:[(0,l.jsx)(d.eb,{value:"all",children:"Tất cả"}),(0,l.jsx)(d.eb,{value:"today",children:"H\xf4m nay"}),(0,l.jsx)(d.eb,{value:"week",children:"7 ng\xe0y qua"}),(0,l.jsx)(d.eb,{value:"month",children:"Th\xe1ng n\xe0y"})]})]})]}),(0,l.jsx)("div",{className:"space-y-2",children:w?(0,l.jsx)("p",{className:"py-4 text-center text-muted-foreground",children:"Đang tải th\xf4ng b\xe1o..."}):k?(0,l.jsx)("p",{className:"py-4 text-center text-destructive",children:k}):A.length>0?A.map(e=>(0,l.jsxs)("div",{className:(0,o.cn)("rounded-lg border p-3 transition-colors hover:bg-muted/50",!e.read&&"border-l-4 border-l-primary"),children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("h3",{className:"font-medium",children:e.title}),(0,l.jsx)("span",{className:"text-xs text-muted-foreground",children:e.time})]}),(0,l.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:x(e.content,40)}),(0,l.jsx)("div",{className:"mt-2 flex justify-end",children:(0,l.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>D(e),children:"Xem chi tiết"})})]},e.id)):(0,l.jsx)("p",{className:"py-4 text-center text-muted-foreground",children:"Kh\xf4ng c\xf3 th\xf4ng b\xe1o n\xe0o"})}),(0,l.jsx)(h.lG,{open:!!p,onOpenChange:e=>!e&&v(null),children:(0,l.jsxs)(h.Cf,{className:"sm:max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[(0,l.jsx)(h.c7,{children:(0,l.jsx)(h.L3,{children:null==p?void 0:p.title})}),(0,l.jsxs)("div",{className:"space-y-4 overflow-y-auto pr-1 flex-grow",children:[(0,l.jsx)("p",{className:"break-words",children:null==p?void 0:p.fullContent}),(0,l.jsx)("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:(0,l.jsx)("span",{children:null==p?void 0:p.time})})]}),(0,l.jsx)("div",{className:"mt-4 flex justify-end pt-2 border-t",children:(0,l.jsx)(h.HM,{asChild:!0,children:(0,l.jsx)(i.$,{children:"Đ\xf3ng"})})})]})})]})})}},7051:(e,t,n)=>{Promise.resolve().then(n.bind(n,1734))}},e=>{var t=t=>e(e.s=t);e.O(0,[543,692,62,33,81,441,684,358],()=>t(7051)),_N_E=e.O()}]);